import{r as i,j as e,L as M,S as j}from"./app-XayEYSYD.js";import{A as R}from"./app-layout-BLklepEH.js";import{F as t,I as r,S as y,s as m}from"./DeleteOutlined-mZWwg84i.js";import{S}from"./EditOutlined-Bhz4Wyub.js";import{R as O}from"./SearchOutlined-E3wJIZQj.js";import{B as f}from"./AntdIcon-DeFWeEBR.js";import{R as N,F as $,M as P,a as T,b as q}from"./PlusOutlined-C_aSAPHO.js";import"./app-logo-icon-wuWTRmV1.js";import"./index-DPAlOoSd.js";import"./index-BMuuFPYu.js";import"./index-CMHfjOm0.js";const D=[{title:"Vehicles",href:"/vehicles"}];function ee({vehicles:b,barangays:v}){const[h,p]=i.useState(b),[V,o]=i.useState(!1),[n]=t.useForm(),[c,C]=i.useState(null),[d,w]=i.useState(""),[g,F]=i.useState(null),[I,x]=i.useState(!1),L=[{title:"Code",dataIndex:"code",key:"code",filteredValue:[d],onFilter:(s,a)=>a.code.toLowerCase().includes(s.toLowerCase())||a.plate_number.toLowerCase().includes(s.toLowerCase())},{title:"Plate Number",dataIndex:"plate_number",key:"plate_number"},{title:"Brand",dataIndex:"brand",key:"brand"},{title:"Model",dataIndex:"model",key:"model"},{title:"Barangay",dataIndex:"barangay",key:"barangay",render:s=>s.name},{title:"Actions",key:"actions",render:(s,a)=>e.jsxs(S,{children:[e.jsx(f,{icon:e.jsx(T,{}),onClick:()=>_(a)}),e.jsx(f,{danger:!0,icon:e.jsx(q,{}),onClick:()=>A(a.id),loading:I}),e.jsx(f,{type:"primary",onClick:()=>j.get(`/vehicles/${a.id}/location`),children:"View Realtime Location"})]})}];i.useEffect(()=>{p(b)},[b]);const k=()=>{C(null),n.resetFields(),o(!0)},_=s=>{C(s),n.setFieldsValue({...s,barangay_id:s.barangay.id}),o(!0)},A=async s=>{try{x(!0),await j.delete(`/vehicles/${s}`,{onSuccess:()=>{p(h.filter(a=>a.id!==s)),m.success("Vehicle deleted successfully")},onError:()=>{m.error("Failed to delete vehicle")},preserveScroll:!0})}catch{m.error("Failed to delete vehicle")}finally{x(!1)}},E=async()=>{try{const s=await n.validateFields();x(!0),c?await j.put(`/vehicles/${c.id}`,s,{onSuccess:a=>{const u=a.props.vehicles.find(l=>l.id===c.id);p(h.map(l=>l.id===c.id?u:l)),m.success("Vehicle updated successfully"),o(!1)},onError:a=>{n.setFields(Object.entries(a).map(([u,l])=>({name:u,errors:Array.isArray(l)?l:[l]})))},preserveScroll:!0}):await j.post("/vehicles",s,{onSuccess:a=>{p([...h,a.props.vehicle]),m.success("Vehicle added successfully"),o(!1)},onError:a=>{n.setFields(Object.entries(a).map(([u,l])=>({name:u,errors:Array.isArray(l)?l:[l]})))},preserveScroll:!0})}catch(s){console.error("Validation failed:",s)}finally{x(!1)}},B=h.filter(s=>(!g||s.barangay.id===g)&&(d===""||s.code.toLowerCase().includes(d.toLowerCase())||s.plate_number.toLowerCase().includes(d.toLowerCase())));return e.jsxs(R,{breadcrumbs:D,children:[e.jsx(M,{title:"Vehicles Management"}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 flex justify-between",children:[e.jsxs(S,{children:[e.jsx(r,{placeholder:"Search vehicles...",prefix:e.jsx(O,{}),onChange:s=>w(s.target.value),value:d,allowClear:!0}),e.jsx(y,{placeholder:"Filter by Barangay",style:{width:200},onChange:s=>F(s),allowClear:!0,value:g,children:v.map(s=>e.jsx(y.Option,{value:s.id,children:s.name},s.id))})]}),e.jsx(f,{type:"primary",icon:e.jsx(N,{}),onClick:k,children:"Add Vehicle"})]}),e.jsx($,{columns:L,dataSource:B,rowKey:"id"}),e.jsx(P,{title:c?"Edit Vehicle":"Add Vehicle",open:V,onOk:E,onCancel:()=>o(!1),destroyOnClose:!0,confirmLoading:I,children:e.jsxs(t,{form:n,layout:"vertical",initialValues:{barangay_id:void 0},children:[e.jsx(t.Item,{name:"code",label:"Code",rules:[{required:!0,message:"Please input vehicle code!"}],children:e.jsx(r,{})}),e.jsx(t.Item,{name:"plate_number",label:"Plate Number",rules:[{required:!0,message:"Please input plate number!"}],children:e.jsx(r,{})}),e.jsx(t.Item,{name:"brand",label:"Brand",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"model",label:"Model",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"color",label:"Color",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"year",label:"Year",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"chassis_number",label:"Chassis Number",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"engine_number",label:"Engine Number",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"vehicle_type",label:"Vehicle Type",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"barangay_id",label:"Barangay",rules:[{required:!0,message:"Please select barangay!"}],children:e.jsx(y,{children:v.map(s=>e.jsx(y.Option,{value:s.id,children:s.name},s.id))})})]})})]})]})}export{ee as default};
