import{r as i,j as a,L as P}from"./app-C00gqaXt.js";import{A as E}from"./app-layout-DjaNfa2R.js";import{F as r,S as f,b as l,Z as m,B as y,R as A,a as B,M as L,c as M,d as N,s as n}from"./PlusOutlined-C6ed8ymZ.js";import{R}from"./SearchOutlined-Cv19-JyK.js";import"./app-logo-icon-Bt1CmNXB.js";import"./index-CnzNiQl8.js";import"./index-DOV4yghA.js";const q=[{title:"Drivers",href:"/drivers"}];function G({drivers:x,barangays:h}){const[d,c]=i.useState(x),[g,o]=i.useState(!1),[u]=r.useForm(),[t,j]=i.useState(null),[v,w]=i.useState(""),[p,I]=i.useState(null),_=[{title:"Name",dataIndex:"name",key:"name",filteredValue:[v],onFilter:(e,s)=>s.name.toLowerCase().includes(e.toLowerCase())},{title:"Barangay",dataIndex:"barangay",key:"barangay",render:e=>e.name},{title:"License No",dataIndex:"drivers_license_number",key:"drivers_license_number"},{title:"Contact",dataIndex:"contact_number",key:"contact_number"},{title:"Email",dataIndex:"user",key:"email",render:e=>(e==null?void 0:e.email)||"N/A"},{title:"Actions",key:"actions",render:(e,s)=>a.jsxs(f,{children:[a.jsx(y,{icon:a.jsx(M,{}),onClick:()=>C(s)}),a.jsx(y,{danger:!0,icon:a.jsx(N,{}),onClick:()=>S(s.id)})]})}];i.useEffect(()=>{c(x)},[x]);const D=()=>{j(null),u.resetFields(),o(!0)},C=e=>{var s;j(e),u.setFieldsValue({...e,barangay_id:e.barangay.id,email:(s=e.user)==null?void 0:s.email}),o(!0)},S=async e=>{try{await window.axios.delete(`/drivers/${e}`),c(d.filter(s=>s.id!==e)),n.success("Driver deleted successfully")}catch{n.error("Failed to delete driver")}},k=async()=>{try{const e=await u.validateFields();if(t){const{data:s}=await window.axios.put(`/drivers/${t.id}`,{...e,barangay_id:e.barangay_id});c(d.map(b=>b.id===t.id?s:b)),n.success("Driver updated successfully")}else{const{data:s}=await window.axios.post("/drivers",{...e,barangay_id:e.barangay_id});c([...d,s]),n.success("Driver added successfully")}o(!1)}catch{n.error("Operation failed")}},F=d.filter(e=>!p||e.barangay.id===p);return a.jsxs(E,{breadcrumbs:q,children:[a.jsx(P,{title:"Drivers Management"}),a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"mb-4 flex justify-between",children:[a.jsxs(f,{children:[a.jsx(l,{placeholder:"Search drivers...",prefix:a.jsx(R,{}),onChange:e=>w(e.target.value),value:v}),a.jsx(m,{placeholder:"Filter by Barangay",style:{width:200},onChange:e=>I(e),allowClear:!0,value:p,children:h.map(e=>a.jsx(m.Option,{value:e.id,children:e.name},e.id))})]}),a.jsx(y,{type:"primary",icon:a.jsx(A,{}),onClick:D,children:"Add Driver"})]}),a.jsx(B,{columns:_,dataSource:F,rowKey:"id"}),a.jsx(L,{title:t?"Edit Driver":"Add Driver",open:g,onOk:k,onCancel:()=>o(!1),destroyOnClose:!0,children:a.jsxs(r,{form:u,layout:"vertical",initialValues:{barangay_id:void 0},children:[a.jsx(r.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please input driver name!"}],children:a.jsx(l,{})}),a.jsx(r.Item,{name:"barangay_id",label:"Barangay",rules:[{required:!0,message:"Please select barangay!"}],children:a.jsx(m,{children:h.map(e=>a.jsx(m.Option,{value:e.id,children:e.name},e.id))})}),a.jsx(r.Item,{name:"drivers_license_number",label:"License No",rules:[{required:!0,message:"Please input license number!"}],children:a.jsx(l,{})}),a.jsx(r.Item,{name:"contact_number",label:"Contact",rules:[{required:!1,message:"Please input contact number!"}],children:a.jsx(l,{})}),a.jsx(r.Item,{name:"email",label:"Email",rules:[{required:!t,message:"Please input email!"},{type:"email",message:"Please enter a valid email!"}],children:a.jsx(l,{type:"email"})}),!t&&a.jsx(r.Item,{name:"password",label:"Password",rules:[{required:!0,message:"Please input password!"},{min:8,message:"Password must be at least 8 characters!"}],children:a.jsx(l.Password,{})})]})})]})]})}export{G as default};
