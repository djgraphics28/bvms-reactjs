import{r as i,j as e,L as M,S as j}from"./app-C00gqaXt.js";import{A as R}from"./app-layout-DjaNfa2R.js";import{F as t,S,b as r,Z as y,B as b,R as O,a as N,M as $,c as P,d as T,s as m}from"./PlusOutlined-C6ed8ymZ.js";import{R as q}from"./SearchOutlined-Cv19-JyK.js";import"./app-logo-icon-Bt1CmNXB.js";import"./index-CnzNiQl8.js";import"./index-DOV4yghA.js";const D=[{title:"Vehicles",href:"/vehicles"}];function Q({vehicles:f,barangays:v}){const[h,x]=i.useState(f),[V,c]=i.useState(!1),[n]=t.useForm(),[d,C]=i.useState(null),[o,w]=i.useState(""),[g,L]=i.useState(null),[I,p]=i.useState(!1),F=[{title:"Code",dataIndex:"code",key:"code",filteredValue:[o],onFilter:(s,a)=>a.code.toLowerCase().includes(s.toLowerCase())||a.plate_number.toLowerCase().includes(s.toLowerCase())},{title:"Plate Number",dataIndex:"plate_number",key:"plate_number"},{title:"Brand",dataIndex:"brand",key:"brand"},{title:"Model",dataIndex:"model",key:"model"},{title:"Barangay",dataIndex:"barangay",key:"barangay",render:s=>s.name},{title:"Actions",key:"actions",render:(s,a)=>e.jsxs(S,{children:[e.jsx(b,{icon:e.jsx(P,{}),onClick:()=>_(a)}),e.jsx(b,{danger:!0,icon:e.jsx(T,{}),onClick:()=>A(a.id),loading:I}),e.jsx(b,{type:"primary",onClick:()=>j.get(`/vehicles/${a.id}/location`),children:"View Realtime Location"})]})}];i.useEffect(()=>{x(f)},[f]);const k=()=>{C(null),n.resetFields(),c(!0)},_=s=>{C(s),n.setFieldsValue({...s,barangay_id:s.barangay.id}),c(!0)},A=async s=>{try{p(!0),await j.delete(`/vehicles/${s}`,{onSuccess:()=>{x(h.filter(a=>a.id!==s)),m.success("Vehicle deleted successfully")},onError:()=>{m.error("Failed to delete vehicle")},preserveScroll:!0})}catch{m.error("Failed to delete vehicle")}finally{p(!1)}},E=async()=>{try{const s=await n.validateFields();p(!0),d?await j.put(`/vehicles/${d.id}`,s,{onSuccess:a=>{const u=a.props.vehicles.find(l=>l.id===d.id);x(h.map(l=>l.id===d.id?u:l)),m.success("Vehicle updated successfully"),c(!1)},onError:a=>{n.setFields(Object.entries(a).map(([u,l])=>({name:u,errors:Array.isArray(l)?l:[l]})))},preserveScroll:!0}):await j.post("/vehicles",s,{onSuccess:a=>{x([...h,a.props.vehicle]),m.success("Vehicle added successfully"),c(!1)},onError:a=>{n.setFields(Object.entries(a).map(([u,l])=>({name:u,errors:Array.isArray(l)?l:[l]})))},preserveScroll:!0})}catch(s){console.error("Validation failed:",s)}finally{p(!1)}},B=h.filter(s=>(!g||s.barangay.id===g)&&(o===""||s.code.toLowerCase().includes(o.toLowerCase())||s.plate_number.toLowerCase().includes(o.toLowerCase())));return e.jsxs(R,{breadcrumbs:D,children:[e.jsx(M,{title:"Vehicles Management"}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 flex justify-between",children:[e.jsxs(S,{children:[e.jsx(r,{placeholder:"Search vehicles...",prefix:e.jsx(q,{}),onChange:s=>w(s.target.value),value:o,allowClear:!0}),e.jsx(y,{placeholder:"Filter by Barangay",style:{width:200},onChange:s=>L(s),allowClear:!0,value:g,children:v.map(s=>e.jsx(y.Option,{value:s.id,children:s.name},s.id))})]}),e.jsx(b,{type:"primary",icon:e.jsx(O,{}),onClick:k,children:"Add Vehicle"})]}),e.jsx(N,{columns:F,dataSource:B,rowKey:"id"}),e.jsx($,{title:d?"Edit Vehicle":"Add Vehicle",open:V,onOk:E,onCancel:()=>c(!1),destroyOnClose:!0,confirmLoading:I,children:e.jsxs(t,{form:n,layout:"vertical",initialValues:{barangay_id:void 0},children:[e.jsx(t.Item,{name:"code",label:"Code",rules:[{required:!0,message:"Please input vehicle code!"}],children:e.jsx(r,{})}),e.jsx(t.Item,{name:"plate_number",label:"Plate Number",rules:[{required:!0,message:"Please input plate number!"}],children:e.jsx(r,{})}),e.jsx(t.Item,{name:"brand",label:"Brand",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"model",label:"Model",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"color",label:"Color",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"year",label:"Year",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"chassis_number",label:"Chassis Number",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"engine_number",label:"Engine Number",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"vehicle_type",label:"Vehicle Type",children:e.jsx(r,{})}),e.jsx(t.Item,{name:"barangay_id",label:"Barangay",rules:[{required:!0,message:"Please select barangay!"}],children:e.jsx(y,{children:v.map(s=>e.jsx(y.Option,{value:s.id,children:s.name},s.id))})})]})})]})]})}export{Q as default};
