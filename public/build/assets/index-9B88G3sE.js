import{r as s,K as _,j as e,L as P,S as j}from"./app-C-G7bMw3.js";import{L as V,G as L,M as k,I as G}from"./esm-BAAKhDxp.js";import{A as T}from"./app-layout-DS9t7BUQ.js";import{I as D,F as c,B as u,R as K,a as q,M as U,b as I,S as B,c as W,d as X,s as y}from"./PlusOutlined-C8bB4j5P.js";import"./index-C3UcmTuE.js";import"./app-logo-icon-yaI_0DtJ.js";import"./index-BPOw6HZV.js";var Y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"};function N(){return N=Object.assign?Object.assign.bind():function(n){for(var l=1;l<arguments.length;l++){var g=arguments[l];for(var m in g)Object.prototype.hasOwnProperty.call(g,m)&&(n[m]=g[m])}return n},N.apply(this,arguments)}const Z=(n,l)=>s.createElement(D,N({},n,{ref:l,icon:Y})),H=s.forwardRef(Z),J=[{title:"Dashboard",href:"/dashboard"},{title:"Barangays",href:"/barangays"}],Q="AIzaSyC_WZ0T_FCfAV_G1yfuBGozFa2zOX9l82c",b={lat:15.9061,lng:120.5853};function re(){const{props:n}=_(),[l,g]=s.useState(n.barangays||[]),[m,p]=s.useState(!1),[r]=c.useForm(),[o,S]=s.useState(null),[v,h]=s.useState(b),[C,F]=s.useState(null),[w,E]=s.useState(b),[d,M]=s.useState(null);s.useEffect(()=>{g(n.barangays||[])},[n.barangays]);const A=[{title:"Name",dataIndex:"name",key:"name"},{title:"Latitude",dataIndex:"latitude",key:"latitude"},{title:"Longitude",dataIndex:"longitude",key:"longitude"},{title:"Actions",key:"actions",render:(t,a)=>e.jsxs(B,{children:[e.jsx(u,{icon:e.jsx(H,{}),onClick:()=>j.visit(`/barangays/${a.id}/info`)}),e.jsx(u,{icon:e.jsx(W,{}),onClick:()=>O(a)}),e.jsx(u,{icon:e.jsx(X,{}),danger:!0,onClick:()=>$(a.id)})]})}],O=t=>{S(t.id),r.setFieldsValue(t),h({lat:Number(t.latitude),lng:Number(t.longitude)}),p(!0)},$=async t=>{try{await j.delete(`/barangays/${t}`,{preserveState:!0,preserveScroll:!0}),y.success("Barangay deleted successfully")}catch{y.error("Failed to delete barangay")}},z=t=>{var x,f;const a=(x=t.latLng)==null?void 0:x.lat(),i=(f=t.latLng)==null?void 0:f.lng();a&&i&&(h({lat:Number(a),lng:Number(i)}),r.setFieldsValue({latitude:a,longitude:i}))},R=async t=>{try{o?await j.put(`/barangays/${o}`,t,{preserveState:!0,preserveScroll:!0}):await j.post("/barangays",t,{preserveState:!0,preserveScroll:!0}),y.success(`Barangay ${o?"updated":"created"} successfully`),p(!1),r.resetFields(),S(null),h(b)}catch{y.error(`Failed to ${o?"update":"create"} barangay`)}};return e.jsxs(T,{breadcrumbs:J,children:[e.jsx(P,{title:"Barangays Management"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Barangays Management"}),e.jsx(u,{type:"primary",icon:e.jsx(K,{}),onClick:()=>{S(null),r.resetFields(),h(b),p(!0)},children:"Add Barangay"})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-2",children:[e.jsx("div",{className:"border rounded-xl p-4",children:e.jsx(q,{columns:A,dataSource:l,rowKey:"id",onRow:t=>({onClick:()=>{F(t),E({lat:Number(t.latitude),lng:Number(t.longitude)})}})})}),e.jsx("div",{className:"border rounded-xl p-4",style:{height:"600px"},children:e.jsx(V,{googleMapsApiKey:Q,children:e.jsxs(L,{mapContainerStyle:{width:"100%",height:"100%"},center:w,zoom:14,children:[l.map(t=>e.jsx(k,{position:{lat:Number(t.latitude),lng:Number(t.longitude)},title:t.name,onClick:()=>M(t),animation:(C==null?void 0:C.id)===t.id?google.maps.Animation.BOUNCE:void 0},t.id)),d&&e.jsx(G,{position:{lat:Number(d.latitude),lng:Number(d.longitude)},onCloseClick:()=>M(null),children:e.jsxs("div",{children:[e.jsx("h3",{children:d.name}),e.jsxs("p",{children:["Latitude: ",d.latitude]}),e.jsxs("p",{children:["Longitude: ",d.longitude]})]})})]})})})]}),e.jsx(U,{title:`${o?"Edit":"Add"} Barangay`,open:m,onCancel:()=>p(!1),footer:null,width:800,children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(c,{form:r,layout:"vertical",onFinish:R,children:[e.jsx(c.Item,{name:"name",label:"Barangay Name",rules:[{required:!0,message:"Please input barangay name!"}],children:e.jsx(I,{})}),e.jsx(c.Item,{name:"latitude",label:"Latitude",rules:[{required:!0,message:"Please input latitude!"}],children:e.jsx(I,{type:"number",step:"any"})}),e.jsx(c.Item,{name:"longitude",label:"Longitude",rules:[{required:!0,message:"Please input longitude!"}],children:e.jsx(I,{type:"number",step:"any"})}),e.jsx(c.Item,{children:e.jsxs(B,{children:[e.jsx(u,{type:"primary",htmlType:"submit",children:o?"Update":"Create"}),e.jsx(u,{onClick:()=>p(!1),children:"Cancel"})]})})]}),e.jsx("div",{style:{height:"400px"},children:e.jsx(L,{mapContainerStyle:{width:"100%",height:"100%"},center:v,zoom:14,onClick:z,children:e.jsx(k,{position:v,draggable:!0,onDragEnd:t=>{var x,f;const a=(x=t.latLng)==null?void 0:x.lat(),i=(f=t.latLng)==null?void 0:f.lng();a&&i&&(h({lat:Number(a),lng:Number(i)}),r.setFieldsValue({latitude:a,longitude:i}))}})})})]})})]})]})}export{re as default};
