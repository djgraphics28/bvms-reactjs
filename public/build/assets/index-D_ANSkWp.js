import{r as i,j as a,L as P}from"./app-BmTBJxZi.js";import{A as E}from"./app-layout-CL_Z5kYk.js";import{F as r,I as l,S as u,s as n}from"./DeleteOutlined-Jk5pQea0.js";import{S as b}from"./EditOutlined-CvCLr9WS.js";import{R as A}from"./SearchOutlined-B-8DWkvC.js";import{B as y}from"./AntdIcon-BbWhZ67W.js";import{R as B,F as L,M,a as N,b as R}from"./PlusOutlined-BQsR2MlF.js";import"./app-logo-icon-we7SExpV.js";import"./index--J07tQQR.js";import"./index-D1RxZ5gl.js";import"./index-Cc2TY-u9.js";const q=[{title:"Drivers",href:"/drivers"}];function W({drivers:x,barangays:h}){const[d,o]=i.useState(x),[g,c]=i.useState(!1),[m]=r.useForm(),[t,j]=i.useState(null),[f,w]=i.useState(""),[p,I]=i.useState(null),_=[{title:"Name",dataIndex:"name",key:"name",filteredValue:[f],onFilter:(e,s)=>s.name.toLowerCase().includes(e.toLowerCase())},{title:"Barangay",dataIndex:"barangay",key:"barangay",render:e=>e.name},{title:"License No",dataIndex:"drivers_license_number",key:"drivers_license_number"},{title:"Contact",dataIndex:"contact_number",key:"contact_number"},{title:"Email",dataIndex:"user",key:"email",render:e=>(e==null?void 0:e.email)||"N/A"},{title:"Actions",key:"actions",render:(e,s)=>a.jsxs(b,{children:[a.jsx(y,{icon:a.jsx(N,{}),onClick:()=>S(s)}),a.jsx(y,{danger:!0,icon:a.jsx(R,{}),onClick:()=>C(s.id)})]})}];i.useEffect(()=>{o(x)},[x]);const D=()=>{j(null),m.resetFields(),c(!0)},S=e=>{var s;j(e),m.setFieldsValue({...e,barangay_id:e.barangay.id,email:(s=e.user)==null?void 0:s.email}),c(!0)},C=async e=>{try{await window.axios.delete(`/drivers/${e}`),o(d.filter(s=>s.id!==e)),n.success("Driver deleted successfully")}catch{n.error("Failed to delete driver")}},k=async()=>{try{const e=await m.validateFields();if(t){const{data:s}=await window.axios.put(`/drivers/${t.id}`,{...e,barangay_id:e.barangay_id});o(d.map(v=>v.id===t.id?s:v)),n.success("Driver updated successfully")}else{const{data:s}=await window.axios.post("/drivers",{...e,barangay_id:e.barangay_id});o([...d,s]),n.success("Driver added successfully")}c(!1)}catch{n.error("Operation failed")}},F=d.filter(e=>!p||e.barangay.id===p);return a.jsxs(E,{breadcrumbs:q,children:[a.jsx(P,{title:"Drivers Management"}),a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"mb-4 flex justify-between",children:[a.jsxs(b,{children:[a.jsx(l,{placeholder:"Search drivers...",prefix:a.jsx(A,{}),onChange:e=>w(e.target.value),value:f}),a.jsx(u,{placeholder:"Filter by Barangay",style:{width:200},onChange:e=>I(e),allowClear:!0,value:p,children:h.map(e=>a.jsx(u.Option,{value:e.id,children:e.name},e.id))})]}),a.jsx(y,{type:"primary",icon:a.jsx(B,{}),onClick:D,children:"Add Driver"})]}),a.jsx(L,{columns:_,dataSource:F,rowKey:"id"}),a.jsx(M,{title:t?"Edit Driver":"Add Driver",open:g,onOk:k,onCancel:()=>c(!1),destroyOnClose:!0,children:a.jsxs(r,{form:m,layout:"vertical",initialValues:{barangay_id:void 0},children:[a.jsx(r.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please input driver name!"}],children:a.jsx(l,{})}),a.jsx(r.Item,{name:"barangay_id",label:"Barangay",rules:[{required:!0,message:"Please select barangay!"}],children:a.jsx(u,{children:h.map(e=>a.jsx(u.Option,{value:e.id,children:e.name},e.id))})}),a.jsx(r.Item,{name:"drivers_license_number",label:"License No",rules:[{required:!0,message:"Please input license number!"}],children:a.jsx(l,{})}),a.jsx(r.Item,{name:"contact_number",label:"Contact",rules:[{required:!1,message:"Please input contact number!"}],children:a.jsx(l,{})}),a.jsx(r.Item,{name:"email",label:"Email",rules:[{required:!t,message:"Please input email!"},{type:"email",message:"Please enter a valid email!"}],children:a.jsx(l,{type:"email"})}),!t&&a.jsx(r.Item,{name:"password",label:"Password",rules:[{required:!0,message:"Please input password!"},{min:8,message:"Password must be at least 8 characters!"}],children:a.jsx(l.Password,{})})]})})]})]})}export{W as default};
