import{K as P,r as s,j as e,L as G,S as p}from"./app-BmTBJxZi.js";import{L as V,G as I,M as k,I as z}from"./esm-h8sClGCl.js";import{A as T}from"./app-layout-CL_Z5kYk.js";import{F as o,I as f,s as x}from"./DeleteOutlined-Jk5pQea0.js";import{B as d}from"./AntdIcon-BbWhZ67W.js";import{R as D,F as K,M as O,a as q,b as U}from"./PlusOutlined-BQsR2MlF.js";import{S as L}from"./EditOutlined-CvCLr9WS.js";import{R as W}from"./InfoCircleOutlined-CqsGyngB.js";import"./index-Cc2TY-u9.js";import"./app-logo-icon-we7SExpV.js";import"./index--J07tQQR.js";import"./index-D1RxZ5gl.js";const X=[{title:"Dashboard",href:"/dashboard"},{title:"Barangays",href:"/barangays"}],Y="AIzaSyC_WZ0T_FCfAV_G1yfuBGozFa2zOX9l82c",h={lat:15.9061,lng:120.5853};function oe(){const{props:y}=P(),[S,F]=s.useState(y.barangays||[]),[M,c]=s.useState(!1),[n]=o.useForm(),[i,j]=s.useState(null),[N,u]=s.useState(h),[b,v]=s.useState(null),[B,E]=s.useState(h),[r,C]=s.useState(null);s.useEffect(()=>{F(y.barangays||[])},[y.barangays]);const A=[{title:"Name",dataIndex:"name",key:"name"},{title:"Latitude",dataIndex:"latitude",key:"latitude"},{title:"Longitude",dataIndex:"longitude",key:"longitude"},{title:"Actions",key:"actions",render:(t,a)=>e.jsxs(L,{children:[e.jsx(d,{icon:e.jsx(W,{}),onClick:()=>p.visit(`/barangays/${a.id}/info`)}),e.jsx(d,{icon:e.jsx(q,{}),onClick:()=>w(a)}),e.jsx(d,{icon:e.jsx(U,{}),danger:!0,onClick:()=>R(a.id)})]})}],w=t=>{j(t.id),n.setFieldsValue(t),u({lat:Number(t.latitude),lng:Number(t.longitude)}),c(!0)},R=async t=>{try{await p.delete(`/barangays/${t}`,{preserveState:!0,preserveScroll:!0}),x.success("Barangay deleted successfully")}catch{x.error("Failed to delete barangay")}},$=t=>{var m,g;const a=(m=t.latLng)==null?void 0:m.lat(),l=(g=t.latLng)==null?void 0:g.lng();a&&l&&(u({lat:Number(a),lng:Number(l)}),n.setFieldsValue({latitude:a,longitude:l}))},_=async t=>{try{i?await p.put(`/barangays/${i}`,t,{preserveState:!0,preserveScroll:!0}):await p.post("/barangays",t,{preserveState:!0,preserveScroll:!0}),x.success(`Barangay ${i?"updated":"created"} successfully`),c(!1),n.resetFields(),j(null),u(h)}catch{x.error(`Failed to ${i?"update":"create"} barangay`)}};return e.jsxs(T,{breadcrumbs:X,children:[e.jsx(G,{title:"Barangays Management"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Barangays Management"}),e.jsx(d,{type:"primary",icon:e.jsx(D,{}),onClick:()=>{j(null),n.resetFields(),u(h),c(!0)},children:"Add Barangay"})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-2",children:[e.jsx("div",{className:"border rounded-xl p-4",children:e.jsx(K,{columns:A,dataSource:S,rowKey:"id",onRow:t=>({onClick:()=>{v(t),E({lat:Number(t.latitude),lng:Number(t.longitude)})}})})}),e.jsx("div",{className:"border rounded-xl p-4",style:{height:"600px"},children:e.jsx(V,{googleMapsApiKey:Y,children:e.jsxs(I,{mapContainerStyle:{width:"100%",height:"100%"},center:B,zoom:14,children:[S.map(t=>e.jsx(k,{position:{lat:Number(t.latitude),lng:Number(t.longitude)},title:t.name,onClick:()=>C(t),animation:(b==null?void 0:b.id)===t.id?google.maps.Animation.BOUNCE:void 0},t.id)),r&&e.jsx(z,{position:{lat:Number(r.latitude),lng:Number(r.longitude)},onCloseClick:()=>C(null),children:e.jsxs("div",{children:[e.jsx("h3",{children:r.name}),e.jsxs("p",{children:["Latitude: ",r.latitude]}),e.jsxs("p",{children:["Longitude: ",r.longitude]})]})})]})})})]}),e.jsx(O,{title:`${i?"Edit":"Add"} Barangay`,open:M,onCancel:()=>c(!1),footer:null,width:800,children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(o,{form:n,layout:"vertical",onFinish:_,children:[e.jsx(o.Item,{name:"name",label:"Barangay Name",rules:[{required:!0,message:"Please input barangay name!"}],children:e.jsx(f,{})}),e.jsx(o.Item,{name:"latitude",label:"Latitude",rules:[{required:!0,message:"Please input latitude!"}],children:e.jsx(f,{type:"number",step:"any"})}),e.jsx(o.Item,{name:"longitude",label:"Longitude",rules:[{required:!0,message:"Please input longitude!"}],children:e.jsx(f,{type:"number",step:"any"})}),e.jsx(o.Item,{children:e.jsxs(L,{children:[e.jsx(d,{type:"primary",htmlType:"submit",children:i?"Update":"Create"}),e.jsx(d,{onClick:()=>c(!1),children:"Cancel"})]})})]}),e.jsx("div",{style:{height:"400px"},children:e.jsx(I,{mapContainerStyle:{width:"100%",height:"100%"},center:N,zoom:14,onClick:$,children:e.jsx(k,{position:N,draggable:!0,onDragEnd:t=>{var m,g;const a=(m=t.latLng)==null?void 0:m.lat(),l=(g=t.latLng)==null?void 0:g.lng();a&&l&&(u({lat:Number(a),lng:Number(l)}),n.setFieldsValue({latitude:a,longitude:l}))}})})})]})})]})]})}export{oe as default};
